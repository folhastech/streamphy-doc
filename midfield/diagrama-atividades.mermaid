stateDiagram-v2
    [*] --> ReceberMensagemMQTT
    
    ReceberMensagemMQTT --> ExtrairIdGateway
    ExtrairIdGateway --> VerificarGateway
    
    VerificarGateway --> GatewayNaoEncontrado: Não encontrado
    GatewayNaoEncontrado --> RegistrarErro
    RegistrarErro --> [*]
    
    VerificarGateway --> BuscarEmpresa: Gateway encontrado
    BuscarEmpresa --> EmpresaNaoEncontrada: Não encontrada
    EmpresaNaoEncontrada --> RegistrarErro
    
    BuscarEmpresa --> ConverterMensagem: Empresa encontrada
    ConverterMensagem --> ErroConversao: Erro
    ErroConversao --> RegistrarErro
    
    ConverterMensagem --> VerificarDestinoMensagem: Convertida com sucesso
    
    VerificarDestinoMensagem --> EnviarWebhook: Webhook configurado
    VerificarDestinoMensagem --> EnviarMQTT: MQTT configurado
    
    EnviarWebhook --> RegistrarEvento
    EnviarMQTT --> RegistrarEvento
    
    RegistrarEvento --> [*]
